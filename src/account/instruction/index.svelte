<script lang="ts">
    import * as UIkit from 'uikit';
    import type { VpnConfig } from '../../database';
    import Docker from './docker.svelte';
    import Openwrt from './openwrt.svelte';

    interface Props {
        config: VpnConfig,
        shareVpnElement: HTMLElement,
    }

    let { config, shareVpnElement }: Props = $props();

    const onConnectClick = function(): void {
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.openLink(`${location.origin}#?redirect=${encodeURIComponent(config.hiddifyOpenUrl)}`);
        } else {
            window.location.href = config.hiddifyOpenUrl;
        }
    };

    let accordion: HTMLElement;
    let accourdionList: HTMLElement[] = [];

    const onSwitchAccorion = function(index: number): void {
        UIkit.accordion(accordion).toggle(index);
        if (window.innerWidth < 768) {
            accourdionList[index - 1]?.scrollIntoView({ behavior: 'smooth' });
        }
    };

    let dockerConfig = $state(null);
    let openwrtConfig = $state(null);

    const onShareClick = function(): void {
        shareVpnElement?.scrollIntoView({ behavior: 'smooth' });
    };
</script>

<div class="uk-padding uk-card uk-card-default uk-card-body">
    <ul uk-accordion bind:this={accordion}>
        <li bind:this={accourdionList[0]} class="uk-open">
            <a class="uk-accordion-title" href>–®–∞–≥ 1: —Å–∫–∞—á–∞–π <b>Hiddify</b></a>
            <div class="uk-accordion-content">
                <p>–í—ã–±–µ—Ä–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</p>
                <div class="" uk-grid>
                    <ul class="uk-list uk-list-divider uk-width-1-4@m uk-width-1-2">
                        <li>
                            <a class="uk-link" href="https://apps.apple.com/us/app/hiddify-proxy-vpn/id6596777532" target="_blank">üì± iPhone</a>
                        </li>
                        <li>
                            <a class="uk-link" href="https://apps.apple.com/us/app/hiddify-proxy-vpn/id6596777532" target="_blank">üì± iPad</a>
                        </li>
                        <li>
                            <a class="uk-link" href="https://play.google.com/store/apps/details?id=app.hiddify.com" target="_blank">üì± Android</a>
                        </li>
                    </ul>
                    <ul class="uk-list uk-list-divider uk-width-1-4@m uk-width-1-2">
                        <li>
                            <a class="uk-link" href="https://apps.apple.com/us/app/hiddify-proxy-vpn/id6596777532" target="_blank">üíª macOS</a>
                        </li>
                        <li>
                            <a class="uk-link" href="https://play.google.com/store/apps/details?id=app.hiddify.com" target="_blank">üñ•Ô∏è Windows</a>
                        </li>
                        <li>
                            <a class="uk-link" href="https://github.com/hiddify/hiddify-app/releases/latest" target="_blank">üñ•Ô∏è Linux</a>
                        </li>
                    </ul>
                    <ul class="uk-list uk-list-divider uk-width-1-4@m uk-width-1-2">
                        <li>
                            <a class="uk-link" href="https://apps.apple.com/us/app/hiddify-proxy-vpn/id6596777532" target="_blank">üì∫ Apple TV</a>
                        </li>
                        <li>
                            <a class="uk-link" href="https://play.google.com/store/apps/details?id=app.hiddify.com" target="_blank">üì∫ Android TV</a>
                        </li>
                    </ul>
                    <ul class="uk-list uk-list-divider uk-width-1-4@m uk-width-1-2">
                        <li>
                            <Openwrt bind:config={openwrtConfig} />
                            <a class="uk-link uk-text-small" onclick={() => openwrtConfig = config}>üõú OpenWRT</a>
                        </li>
                        <li>
                            <Docker bind:config={dockerConfig} />
                            <a class="uk-link uk-text-small" onclick={() => dockerConfig = config}>üê≥ Socks5 Docker</a>
                        </li>
                        <li>
                            <span class="uk-link uk-text-small" >‚öôÔ∏è Xray client config</span>
                            <div uk-dropdown>
                                <ul>
                                    <li><a class="uk-link uk-text-small" href={config.xrayClientConfigSocks5Url} target="_blank">Socks5</a></li>
                                    <li><a class="uk-link uk-text-small" href={config.xrayClientConfigTproxyUrl} target="_blank">TProxy</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
                <p>–ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—à—å, –Ω–µ —Å–ø–µ—à–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è —Å—é–¥–∞ –∏ –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ì–æ—Ç–æ–≤–æ!"</p>
                <div class="uk-text-center">
                    <button class="uk-button uk-button-primary" onclick={() => onSwitchAccorion(1)}>–ì–æ—Ç–æ–≤–æ!</button>
                </div>
            </div>
        </li>
        <li bind:this={accourdionList[1]}>
            <a class="uk-accordion-title" href>–®–∞–≥ 2: –≤—ã–∫–ª—é—á–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ <b>—Ä–æ—Å—Å–∏–π—Å–∫–∏–µ</b> —Ä–µ—Å—É—Ä—Å—ã</a>
            <div class="uk-accordion-content">
                <p class="uk-text-italic uk-text-small uk-text-muted">...—á—Ç–æ–±—ã –Ω–µ –≤–∫–ª—é—á–∞—Ç—å –∏ –≤—ã–∫–ª—é—á–∞—Ç—å –≤–ø–Ω –∫–∞–∂–¥—ã–π —Ä–∞–∑</p>
                <ol>
                    <li>–û—Ç–∫—Ä–æ–π <b>Hiddify</b></li>
                    <li>–ü–æ—è–≤–∏—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –í–ü–ù –∫–æ–Ω—Ñ–∏–≥—Ä—É—Ä–∞—Ü–∏–π. <b>–†–∞–∑—Ä–µ—à–∏</b>.</li>
                    <li>–î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è —ç–∫—Ä–∞–Ω –ø–µ—Ä–≤–∏—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –Ω–∞–π–¥–∏ –Ω–∞ –Ω–µ–º –ø–æ–ª–µ <b>Region</b> –∏ –≤—ã–±–µ—Ä–∏ <b>Russia (ru)</b></li>
                    <li>–ù–∞–∂–º–∏ <b>Start</b></li>
                </ol>
                <p>–ö–∞–∫ —Å–¥–µ–ª–∞–µ—à—å, –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è —Å—é–¥–∞ –∏ –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ì–æ—Ç–æ–≤–æ!"</p>
                <div class="uk-text-center uk-margin-top">
                    <button class="uk-button uk-button-primary" onclick={() => onSwitchAccorion(2)}>–ì–æ—Ç–æ–≤–æ!</button>
                </div>
            </div>
        </li>
        <li bind:this={accourdionList[2]}>
            <a class="uk-accordion-title" href>–®–∞–≥ 3: <b>–ø–æ–¥–∫–ª—é—á–∏ –í–ü–ù</b></a>
            <div class="uk-accordion-content">
                <p>
                    –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É <b class="uk-text-danger cursor" onclick={onConnectClick}>–ü–æ–¥–∫–ª—é—á–∏—Ç—å –í–ü–ù</b><br/>
                    –û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–æ–ª–∂–Ω–æ –≤—ã—Å–∫–æ—á–∏—Ç—å –∑–µ–ª–µ–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, —á—Ç–æ –í–ü–ù –¥–æ–±–∞–≤–ª–µ–Ω.
                </p>
                <div class="uk-text-center">
                    <button class="uk-button uk-button-danger uk-button-large" onclick={onConnectClick}><b>–ü–æ–¥–∫–ª—é—á–∏—Ç—å –í–ü–ù</b></button>
                </div>
                <p>
                    –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞–∂–º–∏ –Ω–∞ –±–æ–ª—å—à—É—é –∫–Ω–æ–ø–∫—É <b>Connect</b> –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —ç–∫—Ä–∞–Ω–∞.
                </p>
                <p>
                    –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∫–æ–ø–∏—Ä—É–π —Ç–µ–∫—Å—Ç –Ω–∏–∂–µ –∏ –≤—Å—Ç–∞–≤—å –µ–≥–æ –≤ Hiddify:
                </p>
                <p class="uk-text-center">
                    <code>{config.hiddifySubscriptionUrl}</code>
                </p>
                <p class="uk-text-center">
                    <button class="uk-button uk-button-primary" onclick={onShareClick}>üëá –°–¥–µ–ª–∞—Ç—å –í–ü–ù –¥–ª—è –¥—Ä—É–≥–∞! üëá</button>
                </p>
            </div>
        </li>
    </ul>
</div>

<style lang="scss">
    .download-link {
        max-width: 10rem;
        cursor: pointer;
    }

    code {
        text-wrap: auto;
    }
</style>
